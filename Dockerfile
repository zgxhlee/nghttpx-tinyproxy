FROM alpine:edge
# tinyproxy 1.8.4
# nghttp2 1.23
RUN  apk add --no-cache --update tinyproxy nghttp2 \
 &&  mkdir -m 777 /config 
ENV SERVER_CRT="-----BEGIN CERTIFICATE-----MIIEUzCCAzugAwIBAgIBATANBgkqhkiG9w0BAQsFADCBsjELMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nRG9uZzESMBAGA1UEBxMJR3VhbmdaaG91MREwDwYDVQQKEwhqaXppd2FuZzESMBAGA1UECxMJaml6aXdhbmcxMTMwMQYDVQQDDCoqLjFkMzUuc3RhcnRlci11cy1lYXN0LTEub3BlbnNoaWZ0YXBwcy5jb20xHzAdBgkqhkiG9w0BCQEWEGppeml3YW5nQGFvbC5jb20wHhcNMTgwMjA2MTUwMjAwWhcNMjgwMjA2MTUwMjAwWjCBsjELMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nRG9uZzESMBAGA1UEBxMJR3VhbmdaaG91MREwDwYDVQQKEwhqaXppd2FuZzESMBAGA1UECxMJaml6aXdhbmcxMTMwMQYDVQQDDCoqLjFkMzUuc3RhcnRlci11cy1lYXN0LTEub3BlbnNoaWZ0YXBwcy5jb20xHzAdBgkqhkiG9w0BCQEWEGppeml3YW5nQGFvbC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDNEIuxHkhHYc463aaDeUOHnTMhRWve/R00QgbjFqpMRnQ25s0TcU4SyhwaquQ1IVT0HXtA25vUisSyeCauvy8NvSYx13OE+am/Z67lOp/XhjPGjEn3WFrHs53I+zFvYyWiNYInxLV1/Dw+qRkVyHsrblqzn24CFiyt1JMkiCNZYAWFMv7u17+7H0RRNKnaIqJ1AX5S6WjeDBMUf6yHudqTX4lJhdYqP7PZix4haTm3WTX08uJ8QQG0ZRtGIWk7iE5yIh6BT2Z3hfNAk1n1y1Lp4rJR48wXpffr+1buh4Ku3rnY64Ef8IZ2qBi4naXMe9hRSLJa+o9iTyJYp8sukNJbAgMBAAGjcjBwMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFGNXNmH6eYukuZzWADKYdLrRX1dkMAsGA1UdDwQEAwIBBjARBglghkgBhvhCAQEEBAMCAAcwHgYJYIZIAYb4QgENBBEWD3hjYSBjZXJ0aWZpY2F0ZTANBgkqhkiG9w0BAQsFAAOCAQEARYgyJv3Fc6PoKqB/mnBQXXL8dxzwioEjabvg0omLAWEzPoVRKUAXa2fvqe388ctgo555Y6vDdJ9sA/eOxsvyJivryV96bHSBry4djNX6vwv+luyjc+CHWmZcpNwgbs2uTLOx7D4EoIycLqvFhLmTlnuGn3TZ/rg9b81Hxqb8AUcXNc+bOnCe1FGVtS7/N2cMF21YMXYnp1xfPRkPL4FG3UIEuDKMfkNN/qu3Uo10Q3ZbyWBir/E0H8qPf2DhZnMfrTkMcH7NuJ7CsgJoAvrKbjgITypAu9g0IPna3mvCY06H6CjySsRkGl8btl5cFcjl7NdXSb0ST1cUCb+uzjhMvQ==-----END CERTIFICATE-----" SERVER_KEY="-----BEGIN RSA PRIVATE KEY-----MIIEpAIBAAKCAQEAzRCLsR5IR2HOOt2mg3lDh50zIUVr3v0dNEIG4xaqTEZ0NubNE3FOEsocGqrkNSFU9B17QNub1IrEsngmrr8vDb0mMddzhPmpv2eu5Tqf14YzxoxJ91hax7OdyPsxb2MlojWCJ8S1dfw8PqkZFch7K25as59uAhYsrdSTJIgjWWAFhTL+7te/ux9EUTSp2iKidQF+Uulo3gwTFH+sh7nak1+JSYXWKj+z2YseIWk5t1k19PLifEEBtGUbRiFpO4hOciIegU9md4XzQJNZ9ctS6eKyUePMF6X36/tW7oeCrt652OuBH/CGdqgYuJ2lzHvYUUiyWvqPYk8iWKfLLpDSWwIDAQABAoIBAQCxDDL/hfyznK8YxdwJMT5rrP7DIBPlX7XCM6uMjzoTRtT5vcWbnrzgnh0rrRYBBTk61uVedv0QwYrX58LGJwyyGPgMGk+DpKa5OgSXp0jwJM85AlCuPFuMhfiZ2L6yw/BvHzGzsjNVnaRKGWcuFny5X7rx0JmDNa/3mUw9Q0j51NA8SQ9qnBS7kgD4OWzEyjyBxy6/oUJoi1SVrfAJO63W0oPJ2cGvVCmiuntmn94FCDE/C9xsoLZK3nBvUoTRErfNa52I2b0RdoVBwdfyUN4U74GzOZkgnaAcmjMHOn+pH2pHkZMs+udkGzcoZUOGrBxbizcan/xIZl6NNbPYVV4xAoGBAPL9Cu2Zcg9DtUfOospHmUQgV3e1FfX4Mxj4r9Yh5BvzJ2API7ut3S7nR8guvrVRQ1MT1ThI9PuhqJC5Jvt3/hvRrQ+1nHsEfkPz579C/2/qI6jgwZ2qhjIDcy4vMI7o+v3XP0nLBB0q2nPhFIKhQmUX8aNOt/msWcRClZEh9j9jAoGBANgLodK+22bW0dcAmQIbCkBrmpmbtDsVBPY/1Qqwbu75nlTHD2fHctowjtZNdq3WaPXvS20g+QscVEt5PksE0s4CeGtpPUBbQayg/olbH/cK7FYKPWu1EjJh766ViXnUna2K1l/+bnrBZHBEOMEHBbt89BvbY04e3+nTlJ4b7T6pAoGAeut5GML0CTbGQMIOZeecZ/M4bC0mI9zf9HTxdpCEdYMm2xgtimakqnKDRIgpH04xkZhJ14RIsfaQcE3Jo5KK8IW8V2MW+sBGI5gCFyYMVBAM5AR2zYyTAD/wh1+F3/WJ6tl1gZ36wcqI4e/t0TtEfCGFsohC10HR00+fm+CjUmMCgYEAtdjcpeHmFOK+j6U+JQqTj3PDFoZ7prtjiM5jyPKG/Xl4bs16xxSXNNZodDORsHLnuBJqP3nghhybS0fLSiPOOH7V0zsqxk/JsL92YDEmb69vDGDkIBOyNFxA/Yd6xuRSsC9LkFM9tO+xVdnml3sMtSpQ4l3AcZIFUPC5iHfjMrkCgYBR95C0ub4m5ETi5heyZS8Pf7l+xHD4RM1KV4xczlLAHZa2m2zVjmRYB5uU1XGGDj8erb8yNCCONlsTm92lW1N+rDfhugU9srksy74pRSDuO6MmeTuSQ1R3WBEAocWlYQloH/Gau7kRCVXgLzw2hfEr1MGnqK0bMpG0kJA4l//d7g==-----END RSA PRIVATE KEY-----"

ADD entrypoint.sh /entrypoint.sh

ADD tinyproxy.conf /config/tinyproxy.conf
ADD nghttpx.conf   /config/nghttpx.conf

RUN  chmod +x /entrypoint.sh \
 &&  chgrp -R 0 /config \
 &&  chmod -R g+rwX /config 
     
ENTRYPOINT  sh /entrypoint.sh

EXPOSE 8443

FROM alpine:edge
# tinyproxy 1.8.4
# nghttp2 1.23
RUN  apk add --no-cache --update tinyproxy nghttp2 \
 &&  mkdir -m 777 /config 
 
ENV SERVER_CRT="-----BEGIN CERTIFICATE-----MIIETTCCAzWgAwIBAgIBATANBgkqhkiG9w0BAQsFADCBrzELMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nRG9uZzESMBAGA1UEBxMJR3VhbmdaaG91MQ8wDQYDVQQKEwZqendhbmcxEzARBgNVBAsTCmp6d2FuZy5vcmcxMzAxBgNVBAMMKiouN2UxNC5zdGFydGVyLXVzLXdlc3QtMi5vcGVuc2hpZnRhcHBzLmNvbTEdMBsGCSqGSIb3DQEJARYOanp3YW5nQGFvbC5jb20wHhcNMTgwMjAyMTcxNTAwWhcNMjgwMjAyMTcxNTAwWjCBrzELMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nRG9uZzESMBAGA1UEBxMJR3VhbmdaaG91MQ8wDQYDVQQKEwZqendhbmcxEzARBgNVBAsTCmp6d2FuZy5vcmcxMzAxBgNVBAMMKiouN2UxNC5zdGFydGVyLXVzLXdlc3QtMi5vcGVuc2hpZnRhcHBzLmNvbTEdMBsGCSqGSIb3DQEJARYOanp3YW5nQGFvbC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC6MLoOLhhMK9v6ae0F+tVUF9xmmZWgM59+ZdUOzfwlgo1gjDEFZrheEhyH2dABUOkgtyZGkbihVD5HVWLiBWbMm/E/fbaO/SWCxkA3GgcPGEaLLte1f0eN+QjAFbwTi5s8137N/MMwAe012gigZFPh5T4t+MdIrjeTWsOb9laciTpOBvKLC/YIE4FonJg2yC/30gHKaKTtwvZEE1ScmQMivkmUa7G3F+gvxZ4rI7kMWNbjy4/O3unf80OAL9ZubXfXO0QU7H7iuM9PDoNZg/x6bjjb5pC3m73TwmwItKHmUYH8K+w6j8orGp/6Zl0SetrqrOfz66zNnFy3hUyXtWN9AgMBAAGjcjBwMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFEagxq5Vp7irTC2w8v9zwnjgWyO1MAsGA1UdDwQEAwIBBjARBglghkgBhvhCAQEEBAMCAAcwHgYJYIZIAYb4QgENBBEWD3hjYSBjZXJ0aWZpY2F0ZTANBgkqhkiG9w0BAQsFAAOCAQEAScvLm6LFA30HTMreaXa0xBv5bHqJzgeo0u8iTyLhOFeVAExHFaKeJbExl5CxhlXj4hmukvoeyVOZMn7EBssYIepmsiALK9dJkgbEcc3udPAwI46ARMF4lybhnAwT4UKyh/h8sD5pAYPPAmc1OPEnGxvx5be7zxuH1fZvZkt2ovapDmDgXKyF63CCd+LnmKhq0xv7+aaQdvgq1Jw9ujqSDrCplPCzWA8TvmwlauwjaZGXsHH0RXdZdaOmZ2jsJEQDx2fqJtFnCE4okUr8Cw70FWKRoT0klCW+n+qYrK8nNpaiNkg/9IPKApJRGr6pVo7YMJlFd6C5zgjeMNQnc26LVw==-----END CERTIFICATE-----" SERVER_KEY=none1

ADD entrypoint.sh /entrypoint.sh

ADD tinyproxy.conf /config/tinyproxy.conf
ADD nghttpx.conf   /config/nghttpx.conf

RUN  chmod +x /entrypoint.sh \
 &&  chgrp -R 0 /config \
 &&  chmod -R g+rwX /config 
     
ENTRYPOINT  sh /entrypoint.sh

EXPOSE 443
